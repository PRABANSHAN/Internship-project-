<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Admin Dashboard</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
<header>
  <a href="/" class="logo-link"><div class="logo">Student Assistant (Admin)</div></a>
  <nav class="nav-links">
    <a href="/">Home</a>
    <a href="/admin" class="active">Admin</a>
    <a href="/chat">Chat</a>
  </nav>
  <a href="/admin/logout" class="signin-btn">Logout</a>
</header>

<main style="max-width:1100px;margin:30px auto;padding:20px;">
  <h1>Admin Dashboard</h1>
  <section style="margin-bottom:20px;">
    <h2>Users</h2>
    <table style="width:100%;border-collapse:collapse">
      <tr><th style="text-align:left">ID</th><th>Name</th><th>Email</th></tr>
      {% for u in users %}
      <tr style="border-top:1px solid #eee"><td>{{ u.id }}</td><td>{{ u.name }}</td><td>{{ u.email }}</td></tr>
      {% endfor %}
    </table>
  </section>

  <section style="margin-bottom:20px;">
    <h2>Recent Messages</h2>
    <a class="btn" href="/admin/export">Export CSV</a>
    <form method="POST" action="/admin/prune" style="display:inline-block;margin-left:12px;">
      <label>Prune messages older than <input type="number" name="days" value="30" style="width:70px;"> days</label>
      <button class="btn" type="submit">Prune</button>
    </form>
    <div style="margin-top:12px">
      {% for m in messages %}
        <div style="border-bottom:1px solid #f0f0f0;padding:8px 0;">
          <div style="font-size:12px;color:#666">{{ m.created_at }} — user_id: {{ m.user_id }} — {{ m.role }}</div>
          <div>{{ m.content }}</div>
        </div>
      {% endfor %}
    </div>
  </section>
</main>
</body>
</html>
