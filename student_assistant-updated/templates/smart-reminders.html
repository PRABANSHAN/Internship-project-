{% extends "base.html" %}

{% block title %}Smart Reminders - Student Assistant{% endblock %}

{% block content %}
<div class="container py-5">
  <div class="text-center mb-5">
    <h1>Smart Reminders</h1>
    <p class="lead">Receive timely reminders to never miss deadlines or meetings.</p>
  </div>

  <div class="row justify-content-center">
    <div class="col-md-8">
      <div class="card mb-4">
        <div class="card-body">
          <form id="add-reminder-form">
            <div class="row g-3 align-items-center">
              <div class="col-md-5">
                <input type="text" id="reminder-name" class="form-control" placeholder="Reminder Name" required>
              </div>
              <div class="col-md-5">
                <input type="datetime-local" id="reminder-time" class="form-control" required>
              </div>
              <div class="col-md-2 d-grid">
                <button type="submit" class="btn btn-primary">Add</button>
              </div>
            </div>
          </form>
        </div>
      </div>

      <div id="reminder-list" class="list-group">
        {% for reminder in reminders %}
        <div class="list-group-item list-group-item-action" id="reminder-{{ reminder.id }}">
          <div class="d-flex w-100 justify-content-between">
            <h5 class="mb-1">{{ reminder.name }}</h5>
            <small>Time: {{ reminder.time }}</small>
          </div>
          <button class="btn btn-danger btn-sm" onclick="deleteReminder({{ reminder.id }})">Delete</button>
        </div>
        {% endfor %}
      </div>
    </div>
  </div>
</div>

<script>
document.getElementById('add-reminder-form').addEventListener('submit', function(event) {
  event.preventDefault();

  const name = document.getElementById('reminder-name').value;
  const time = document.getElementById('reminder-time').value;

  fetch('/api/reminders', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({ name: name, time: time }),
  })
  .then(response => response.json())
  .then(data => {
    if (data.id) {
      const reminderList = document.getElementById('reminder-list');
      const newReminder = document.createElement('div');
      newReminder.className = 'list-group-item list-group-item-action';
      newReminder.id = 'reminder-' + data.id;
      newReminder.innerHTML = `
        <div class="d-flex w-100 justify-content-between">
          <h5 class="mb-1">${data.name}</h5>
          <small>Time: ${data.time}</small>
        </div>
        <button class="btn btn-danger btn-sm" onclick="deleteReminder(${data.id})">Delete</button>
      `;
      reminderList.appendChild(newReminder);
      document.getElementById('add-reminder-form').reset();
    }
  });
});

function deleteReminder(reminderId) {
  if (confirm('Are you sure you want to delete this reminder?')) {
    fetch('/api/reminders/' + reminderId, {
      method: 'DELETE',
    })
    .then(response => {
      if (response.ok) {
        const reminderElement = document.getElementById('reminder-' + reminderId);
        reminderElement.remove();
      }
    });
  }
}
</script>
{% endblock %}
